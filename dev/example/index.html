<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example of using Wavefronts.jl · Wavefronts.jl documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Wavefronts.jl documentation</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Wavefronts.jl documentation</a></li><li class="is-active"><a class="tocitem" href>Example of using Wavefronts.jl</a><ul class="internal"><li><a class="tocitem" href="#Making-interference-patterns-1"><span>Making interference patterns</span></a></li><li><a class="tocitem" href="#Retrieving-the-phase-step-by-step-1"><span>Retrieving the phase step by step</span></a></li><li><a class="tocitem" href="#Automated-method-1"><span>Automated method</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example of using Wavefronts.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example of using Wavefronts.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Klafyvel/Wavefronts.jl/blob/master/docs/src/example.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-of-using-Wavefronts.jl-1"><a class="docs-heading-anchor" href="#Example-of-using-Wavefronts.jl-1">Example of using Wavefronts.jl</a><a class="docs-heading-anchor-permalink" href="#Example-of-using-Wavefronts.jl-1" title="Permalink"></a></h1><pre><code class="language-julia">using Plots
using Wavefronts</code></pre><pre><code class="language-none">┌ Info: Recompiling stale cache file /home/klafyvel/.julia/compiled/v1.2/Wavefronts/NyKHD.ji for Wavefronts [5a5f1f2e-54ce-422a-b05d-abd9e7c2d134]
└ @ Base loading.jl:1240</code></pre><h2 id="Making-interference-patterns-1"><a class="docs-heading-anchor" href="#Making-interference-patterns-1">Making interference patterns</a><a class="docs-heading-anchor-permalink" href="#Making-interference-patterns-1" title="Permalink"></a></h2><p>Let&#39;s model a phase stepping interferometer. We need four patterns with a reference shifted by π/2 every time.</p><pre><code class="language-julia">x = -1:0.001:1
y = -1:0.001:1
X = repeat(reshape(x, 1, :), length(y), 1)
Y = repeat(y, 1, length(x))
evaluate_intensity(f) = map(f, X, Y)
a = Wavefront(
    Tilt(10)+Coma(10,20)+Spherical(10)+Defocus(10),
    circ
)
patterns = [
    map(intensity(a, Wavefront(Tip(30)+Piston(i*π/2), circ)), X, Y)
    for i in 0:3
];</code></pre><p>The patterns are like this</p><pre><code class="language-julia">heatmap(x,y,patterns[1],aspect_ratio=1,title=&quot;Interference patterns&quot;)</code></pre><p><img src="../output_6_0.svg" alt="svg"/></p><h2 id="Retrieving-the-phase-step-by-step-1"><a class="docs-heading-anchor" href="#Retrieving-the-phase-step-by-step-1">Retrieving the phase step by step</a><a class="docs-heading-anchor-permalink" href="#Retrieving-the-phase-step-by-step-1" title="Permalink"></a></h2><p>Let&#39;s retrieve the raw phase</p><pre><code class="language-julia">raw = rawphase(patterns...)
heatmap(x,y,raw, aspect_ratio=1, title=&quot;Raw phase&quot;)</code></pre><p><img src="../output_9_0.svg" alt="svg"/></p><pre><code class="language-julia">unwrapped = unwrapphase(raw)
heatmap(x,y,unwrapped, aspect_ratio=1, title=&quot;Unwrapped phase&quot;)</code></pre><p><img src="../output_10_0.svg" alt="svg"/></p><p>The reference was tilted, let&#39;s remove it by hand (there is also a function which does it for you).</p><pre><code class="language-julia">ref_ϕ = phase(Wavefront(Tip(30)))</code></pre><pre><code class="language-none">#1 (generic function with 1 method)</code></pre><pre><code class="language-julia">ref_ϕ_values = ref_ϕ.(X,Y)
calc_phase = unwrapped + ref_ϕ_values
heatmap(x,y,calc_phase, aspect_ratio=1, title=&quot;Unwrapped phase, reference removed&quot;)</code></pre><p><img src="../output_13_0.svg" alt="svg"/></p><pre><code class="language-julia">original_values = phase(a).(X,Y)
diff = abs.(original_values - calc_phase)
heatmap(x,y,diff, aspect_ratio=1, title=&quot;Difference between original phase and calculated phase&quot;)</code></pre><p><img src="../output_14_0.svg" alt="svg"/></p><p>It is expected that the border presents weird behaviour. We can ignore that.</p><pre><code class="language-julia">diff .*= circ.(X,Y)
heatmap(x,y,diff, aspect_ratio=1, title=&quot;Difference between original phase and retrieved phase, \nborder removed.&quot;)</code></pre><p><img src="../output_16_0.svg" alt="svg"/></p><p>We can calculate the RMS of the difference</p><pre><code class="language-julia">rms = sqrt(sum(diff.^2) / sum(circ.(X,Y)))</code></pre><pre><code class="language-none">6.2831853071795845</code></pre><p>weird, it looks like the phase shift is constant</p><pre><code class="language-julia">2π - rms</code></pre><pre><code class="language-none">1.7763568394002505e-15</code></pre><p>Yeah, so obviously it&#39;s only an ambiguity over 2π, which makes sens. We can re-evaluate the RMS knowing that</p><pre><code class="language-julia">diff = circ.(X,Y) .* (diff.-2π)
rms = sqrt(sum(diff.^2) / sum(circ.(X,Y)))</code></pre><pre><code class="language-none">4.1568208770299665e-15</code></pre><p>Better :D</p><pre><code class="language-julia">heatmap(x,y,diff, aspect_ratio=1, title=&quot;Difference between original phase and retrieved phase, \nborder and 2pi ambiguity removed.&quot;)</code></pre><p><img src="../output_24_0.svg" alt="svg"/></p><p>Okay, let&#39;s try to find the aberrations in this.</p><pre><code class="language-julia">project(Tilt, calc_phase, mask=circ)</code></pre><pre><code class="language-none">Tilt(9.998483428521132)</code></pre><p>Coool :D, as a reminder, the original aberration was</p><pre><code class="language-julia">Tilt(10)+Coma(10,20)+Spherical(10)+Defocus(10)</code></pre><pre><code class="language-none">Wavefronts.AddAberration(Wavefronts.AddAberration(Wavefronts.AddAberration(Tilt(10), Coma(Wavefronts.HorizontalComa(10), Wavefronts.VerticalComa(20))), Spherical(10)), Defocus(10))</code></pre><p>Let&#39;s find other aberrations !</p><pre><code class="language-julia">project(Tip, calc_phase, mask=circ)</code></pre><pre><code class="language-none">Tip(-0.0006443144242641213)</code></pre><pre><code class="language-julia">project(Coma, calc_phase, mask=circ)</code></pre><pre><code class="language-none">Coma(Wavefronts.HorizontalComa(9.999317746440996), Wavefronts.VerticalComa(19.997991178457728))</code></pre><pre><code class="language-julia">project(Piston, calc_phase, mask=circ)</code></pre><pre><code class="language-none">Piston(-6.284089170735127)</code></pre><p>Oh, here is our <span>$2\pi$</span> error again !</p><pre><code class="language-julia">project(Defocus, calc_phase, mask=circ)</code></pre><pre><code class="language-none">Defocus(9.9989115973913)</code></pre><pre><code class="language-julia">project(Astigmatism, calc_phase, mask=circ)</code></pre><pre><code class="language-none">Astigmatism(Wavefronts.ObliqueAstigmatism(-8.893678329211982e-16), Wavefronts.VerticalAstigmatism(-5.929118886141322e-16))</code></pre><pre><code class="language-julia">project(Trefoil, calc_phase, mask=circ)</code></pre><pre><code class="language-none">Trefoil(Wavefronts.ObliqueTrefoil(-0.001149438351092385), Wavefronts.VerticalTrefoil(0.0031118694231453787))</code></pre><pre><code class="language-julia">project(Spherical, calc_phase, mask=circ)</code></pre><pre><code class="language-none">Spherical(9.998530646137448)</code></pre><p>We can even correct some aberrations !</p><pre><code class="language-julia">corrected = correct(Tilt, calc_phase,mask=circ)
heatmap(x,y,corrected, aspect_ratio=1, title=&quot;Calculated phase corrected of tilt&quot;)</code></pre><p><img src="../output_39_0.svg" alt="svg"/></p><h2 id="Automated-method-1"><a class="docs-heading-anchor" href="#Automated-method-1">Automated method</a><a class="docs-heading-anchor-permalink" href="#Automated-method-1" title="Permalink"></a></h2><p>Of course, in real life you don&#39;t want to do all these steps by yourself and it&#39;s perfectly fine because Wavefronts.jl does them for you. :)</p><pre><code class="language-julia">calc_phase = retrievephase(patterns...; mask=circ, correct_aberrations=[Tilt, Tip, Piston, Defocus])
heatmap(x,y,calc_phase, aspect_ratio=1, title=&quot;Calculated phase corrected of tilt, tip, piston and defocus&quot;)</code></pre><p><img src="../output_42_0.svg" alt="svg"/></p><p>Our calculated phase still have the interesting aberrations (coma and spherical) while the others have been removed. As a reminder the original aberrations were <code>Tilt(10)+Coma(10,20)+Spherical(10)+Defocus(10)</code>.</p><pre><code class="language-julia">project(Tilt, calc_phase, mask=circ), project(Coma, calc_phase, mask=circ), 
project(Spherical, calc_phase, mask=circ), project(Defocus, calc_phase, mask=circ)</code></pre><pre><code class="language-none">(Tilt(0.00022790806120813725), Coma(Wavefronts.HorizontalComa(9.999317748986906), Wavefronts.VerticalComa(19.998635395167106)), Spherical(9.99909178844765), Defocus(0.0004552520838158169))</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Wavefronts.jl documentation</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 26 December 2019 17:35">Thursday 26 December 2019</span>. Using Julia version 1.0.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
